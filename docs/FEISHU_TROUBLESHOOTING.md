# 飞书 API 连接问题排查指南

## 问题现象
- 错误代码：91402
- 错误信息：NOTEXIST
- 多维表格地址：https://bxbdcf9exi.feishu.cn/wiki/Sq1fwq5eDiWbahkWKvBcMS21n0b

## 问题分析

### 1. 企业自建域名问题
您的多维表格使用的是企业自建域名 `bxbdcf9exi.feishu.cn`，但 API 调用需要使用标准域名 `open.feishu.cn`。

### 2. 应用权限问题
从调试结果看，应用信息获取失败 (404)，这通常表示：
- 应用未正确发布
- 应用权限配置不完整
- 应用在企业内部的可见性设置有问题

## 解决方案

### 步骤 1：检查飞书应用配置

1. **登录飞书开放平台**
   - 访问：https://open.feishu.cn/app
   - 使用管理员账号登录

2. **检查应用状态**
   - 找到您的应用：`cli_a821ad29aa7ad00b`
   - 确认应用状态为"已发布"
   - 检查应用是否对企业内部用户可见

3. **检查应用权限**
   确保应用具有以下权限：
   - `bitable:app` - 获取多维表格信息
   - `bitable:app:readonly` - 读取多维表格
   - `bitable:table` - 访问数据表
   - `bitable:table:readonly` - 读取数据表
   - `bitable:record` - 访问记录
   - `bitable:record:write` - 写入记录

### 步骤 2：重新获取 BASE_TOKEN

1. **访问您的多维表格**
   - 地址：https://bxbdcf9exi.feishu.cn/wiki/Sq1fwq5eDiWbahkWKvBcMS21n0b

2. **获取正确的 BASE_TOKEN**
   - 在浏览器中打开多维表格
   - 查看 URL 中的 BASE_TOKEN 部分
   - 当前使用的：`Sq1fwq5eDiWbahkWKvBcMS21n0b`

3. **验证 TABLE_ID**
   - 当前使用的：`tblWZ8EJmkOBuS5m`
   - 确认这是正确的表格 ID

### 步骤 3：检查应用发布状态

1. **应用发布**
   - 在开放平台中，确保应用已发布
   - 检查发布范围是否包含您的企业

2. **权限审批**
   - 确认所有必需的权限都已申请
   - 检查权限是否已被企业管理员审批

3. **应用可见性**
   - 确保应用对目标用户/部门可见
   - 检查应用是否在企业应用列表中

### 步骤 4：测试替代方案

如果上述步骤仍无法解决问题，可以尝试：

1. **创建新的自建应用**
   - 重新创建一个飞书自建应用
   - 重新配置所有必需的权限
   - 重新发布应用

2. **使用用户访问令牌**
   - 考虑使用 `user_access_token` 而不是 `tenant_access_token`
   - 这需要用户授权流程

3. **检查企业设置**
   - 确认企业是否允许自建应用访问多维表格
   - 检查企业的 API 调用限制设置

## 常见错误代码说明

- **91402 NOTEXIST**: 资源不存在
  - BASE_TOKEN 错误
  - 应用无权限访问
  - 多维表格已删除或移动

- **99991 权限不足**: 
  - 应用权限未申请或未审批
  - 应用未发布

- **10014 应用不存在**:
  - APP_ID 或 APP_SECRET 错误
  - 应用已被删除

## 下一步操作

1. 请按照上述步骤检查您的飞书应用配置
2. 确认所有权限都已正确申请和审批
3. 重新运行测试脚本验证连接

如果问题仍然存在，请提供：
- 飞书开放平台中的应用详细信息截图
- 应用权限列表截图
- 应用发布状态截图
